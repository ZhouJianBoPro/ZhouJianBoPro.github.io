---
layout: post
title: mysql主从同步
date: 2022-09-08
tags: [mysql]
---

#### 主从同步的作用
1. 读写分离：主库负责写入数据，从库负责读取数据，提升数据库性能
2. 容灾恢复：在主库不可用时，从库提供服务，提高数据库可用性
3. 数据备份：在主服务器数据损坏丢失时，可以从从库备份恢复

#### 一主多从架构
1. 主库负责所有的读写请求，从库负责容灾恢复及数据备份
2. 若设置了读写分离，则主库提供数据写入操作，从库提供数据的读取操作

#### 主从同步过程
![主从同步过程](/images/mysql-cluster.png)
1. 主库写 binlog 并提交事务
2. 从库开启I/O Thread连接主库，并请求从指定的binlog位置开始同步数据
3. 主库为每个从库创建一个Binlog Dump Thread。当master binlog发生变化时，binlog dump线程会将变化的binlog内容发送给I/O Thread
4. 该I/O Thread在接收到Binlog内容后，写入到本地Relay log（中继文件）
5. 从库的SQL Thread读取Relay log文件内容并完成数据的更新

#### 主从同步复制方式
- 全同步复制：主库和从库都执行完事务后，才给客户端返回成功
- 半同步复制：有一个从库执行完事务后，就给客户端返回成功
- 异步复制：主库事务执行完成后立即给客户端返回成功，不关心从库执行结果

#### 主从同步延迟原因
1. 网络延迟原因，master的binlog同步至slave存在网络延迟
2. 主库与从库事务执行时间差异。特别是大事物，可能主库执行时间较短，然而从库时间执行较长

#### 如何提升主从同步性能
1. 从库开启多线程复制。即在主从同步过程SQL线程读取Relay log文件内容并执行时，按实际情况将线程数多配置一点
2. 对数据安全性没那么高的话，主从同步方式可以配置为异步复制










