---
layout: post
title: AQS实现原理
date: 2025-10-14
tags: [concurrency]
---

#### 死锁/MySQL死锁场景举例
>  A和B同时向对方转账。假设有两个线程t1和t2，t1先获取到账户A的锁，t2也获取到了账户B的锁，
>  此时线程t1还尝试获取账户B的锁，线程t2尝试获取账户A的锁。这样就导致死锁

#### 解决死锁的几种方案
1. 一次同时锁住两个资源
2. 使用Lock代替sychoronzied，lock可以设置获取锁的时间，超过这个时间没获取到锁可以进行自旋
3. 保证资源按一定顺序加锁，比如通过id大小进行排序然后加锁
4. 使用乐观锁代替互斥锁

#### MYSQL如何排查死锁
> 通过show processlist 或者 show engine innodb status 查看死锁信息

#### MYSQL如何避免死锁
1. 尽量避免长事务
2. 建立合适的索引，避免全表扫描
3. 保证资源按一定顺序执行





